version: v1.0
name: Playwright Tests
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Playwright Init
    task:
      secrets:
        - name: BUILDKITE_API_KEY_AMERICO
      jobs:
        - name: Calling Buildkite Playwright Pipeline
          commands:
            - echo '--> Making Buildite API call'
            - >-
              curl --location "https://api.buildkite.com/v2/organizations/hivebrite/pipelines/alumni-connect/builds"
              --header "Content-Type: application/json"
              --header "Authorization: Bearer ${BUILDKITE_API_KEY_AMERICO}"
              --data-raw '{
                "commit": "HEAD",
                "branch": "chore-run-playwright-after-hprod",
                "message": ":rocket: Build initiated from Semaphore :rocket:",
                "author": {
                  "name": "Americo Savinon",
                  "email": "americo.savinon.ext@hivebrite.com"
                },
                "env": {
                  "RUN_PLAYRIGHT_TESTS": "true"
                }
              }'
