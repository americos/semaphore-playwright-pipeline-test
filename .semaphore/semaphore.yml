version: v1.0
name: Playwright Tests
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Playwright Init
    task:
      jobs:
        - name: Playwright Setup
          commands:
            - checkout
            - echo '--> apt-get update'
            - echo '--> OK lets setup Playwright'
            - echo '--> Pulling playwright image'
            - docker pull mcr.microsoft.com/playwright:v1.38.1-jammy
            - echo '--> Running playwright container'
            - container_id=$(docker run -td -v ./e2e/:/e2e/ mcr.microsoft.com/playwright:v1.38.1-jammy)
            - echo '--> Running tests'
            - docker exec "$container_id" sh -c "apt-get remove -y libsoup2.4 && cd e2e && npm install && npx playwright test"
            